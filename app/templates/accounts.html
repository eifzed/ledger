{% extends "base.html" %}
{% set active_page = "accounts" %}
{% block title %}Ledger â€” Accounts{% endblock %}

{% block content %}
<div class="page-header">
  <div>
    <h1>Accounts</h1>
    <div class="subtitle">All accounts and balances</div>
  </div>
</div>

<div class="stat-cards" style="margin-bottom:2rem">
  <div class="stat-card" style="border-left:3px solid var(--accent)">
    <div class="icon-wrap accent">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4z"/></svg>
    </div>
    <div class="stat-info">
      <div class="stat-label">Household Net Worth</div>
      <div class="stat-value {% if grand_total >= 0 %}positive{% else %}negative{% endif %}">{{ idr(grand_total) }}</div>
    </div>
  </div>
</div>

{% for pu in per_user_accounts %}
{% if pu.accounts %}
<div class="section-title">{{ pu.user.display_name }}</div>
<div class="panel" style="margin-bottom:1.75rem">
  <table>
    <thead>
      <tr>
        <th>Account</th>
        <th>Type</th>
        <th>Currency</th>
        <th style="text-align:right">Balance</th>
      </tr>
    </thead>
    <tbody>
      {% for a in pu.accounts %}
      <tr>
        <td>
          <div style="display:flex;align-items:center;gap:8px">
            <div style="width:32px;height:32px;border-radius:8px;background:var(--accent-light);display:flex;align-items:center;justify-content:center;flex-shrink:0">
              <svg style="width:16px;height:16px;color:var(--accent)" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                {% if a.type == 'bank' %}
                <rect x="1" y="4" width="22" height="16" rx="2"/><path d="M1 10h22"/>
                {% elif a.type == 'cash' %}
                <line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                {% elif a.type == 'ewallet' %}
                <rect x="2" y="4" width="20" height="16" rx="2"/><path d="M22 10H18a2 2 0 0 0 0 4h4"/>
                {% else %}
                <circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/>
                {% endif %}
              </svg>
            </div>
            <div>
              <div style="font-weight:600">{{ a.display_name }}</div>
              <div style="font-size:0.6875rem;color:var(--text3)">{{ a.id }}</div>
            </div>
          </div>
        </td>
        <td><span class="badge" style="background:var(--surface-hover);color:var(--text2)">{{ a.type }}</span></td>
        <td style="color:var(--text2)">{{ a.currency }}</td>
        <td class="amount {% if balance_map.get(a.id, 0) >= 0 %}positive{% else %}negative{% endif %}" style="text-align:right;font-size:1rem">
          {{ idr(balance_map.get(a.id, 0)) }}
        </td>
      </tr>
      {% endfor %}
      <tr style="background:var(--surface-hover)">
        <td colspan="3" style="font-weight:700">Subtotal</td>
        <td class="amount {% if pu.total >= 0 %}positive{% else %}negative{% endif %}" style="text-align:right;font-size:1rem;font-weight:700">
          {{ idr(pu.total) }}
        </td>
      </tr>
    </tbody>
  </table>
</div>
{% endif %}
{% endfor %}

{% if shared_accts %}
<div class="section-title">Shared</div>
<div class="panel" style="margin-bottom:1.75rem">
  <table>
    <thead>
      <tr>
        <th>Account</th>
        <th>Type</th>
        <th>Currency</th>
        <th style="text-align:right">Balance</th>
      </tr>
    </thead>
    <tbody>
      {% for a in shared_accts %}
      <tr>
        <td>
          <div style="display:flex;align-items:center;gap:8px">
            <div style="width:32px;height:32px;border-radius:8px;background:var(--purple-light);display:flex;align-items:center;justify-content:center;flex-shrink:0">
              <svg style="width:16px;height:16px;color:var(--purple)" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="4" width="22" height="16" rx="2"/><path d="M1 10h22"/></svg>
            </div>
            <div>
              <div style="font-weight:600">{{ a.display_name }}</div>
              <div style="font-size:0.6875rem;color:var(--text3)">{{ a.id }}</div>
            </div>
          </div>
        </td>
        <td><span class="badge" style="background:var(--surface-hover);color:var(--text2)">{{ a.type }}</span></td>
        <td style="color:var(--text2)">{{ a.currency }}</td>
        <td class="amount {% if balance_map.get(a.id, 0) >= 0 %}positive{% else %}negative{% endif %}" style="text-align:right;font-size:1rem">
          {{ idr(balance_map.get(a.id, 0)) }}
        </td>
      </tr>
      {% endfor %}
      <tr style="background:var(--surface-hover)">
        <td colspan="3" style="font-weight:700">Subtotal</td>
        <td class="amount {% if shared_total >= 0 %}positive{% else %}negative{% endif %}" style="text-align:right;font-size:1rem;font-weight:700">
          {{ idr(shared_total) }}
        </td>
      </tr>
    </tbody>
  </table>
</div>
{% endif %}

{% if not accts %}
<div class="panel">
  <div class="empty-state">No accounts yet.</div>
</div>
{% endif %}
{% endblock %}
